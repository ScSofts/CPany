import{P as e,V as t}from"./index.13faeba3.js";import{i as a,e as s,B as n,C as o,j as r,x as i,o as c,b as p,m as l,d as m,t as d,u,h as f,A as y}from"./vendor.5658d620.js";import{l as v}from"./load.8c215a92.js";import{c as T}from"./codeforces.9e4da7d5.js";import{_ as b,h,f as g}from"./Contest.a7884dc0.js";import"./c-table.0decaf1b.js";import"./user-link.69187dfa.js";import"./cf-rating-color.3480ad5b.js";import"./at-rating-color.bcca90d7.js";const j=v(T),S=new Map;for(const P of j)P.type.startsWith("codeforces")&&S.set(P.id,P);const C={key:0},I={key:1,class:"divide-y"},w=m("h2",{class:"mb-2"},"错误",-1),A={class:"pt-2"},N=s({setup(s){const v=n(),T=o(),j=r(null),N=r(!1),P=r(!1),{start:R,end:O}=function(){const e=a("loading");return{start(){e.value=!0},end(){e.value=!1}}}(),U=r(!1),x=async a=>{var s,n;if(U.value)return;U.value=!0;const o=new URL("https://codeforces.com/api/contest.standings");o.searchParams.append("contestId",""+a.id),o.searchParams.append("handles",h.map((({h:e})=>e)).join(";")),o.searchParams.append("showUnofficial","true");const{result:r}=await(await fetch(o.toString())).json();let i=0;a.problems=r.problems;for(const e of r.problems)e.problemUrl=`https://codeforces.com/contest/${e.contestId}/problem/${e.index}`;a.standings=[];for(const c of r.rows){if(c.party.participantType!==e.CONTESTANT&&c.party.participantType!==e.VIRTUAL&&c.party.participantType!==e.OUT_OF_COMPETITION&&c.party.participantType!==e.PRACTICE)continue;c.party.participantType!==e.PRACTICE&&i++;const o=c.problemResults.reduce(((e,t)=>{var a,s;return 0===t.points?e:e+(null!=(a=t.bestSubmissionTimeSeconds)?a:0)+20*(null!=(s=t.rejectedAttemptCount)?s:0)}),0),r=null!=(s=c.party.participantTime)?s:a.startTime;a.standings.push({author:{members:c.party.members.map((e=>e.handle)),teamName:null!=(n=c.party.teamName)?n:g(c.party.members[0].handle),participantTime:r,participantType:c.party.participantType},rank:c.rank,solved:c.problemResults.filter((e=>e.points>0)).length,penalty:o,submissions:c.problemResults.map(((e,a)=>{const s=e.bestSubmissionTimeSeconds+r,n=e.bestSubmissionTimeSeconds;return e.points>0?{id:-1,creationTime:s,relativeTime:n,problemIndex:a,verdict:t.OK,dirty:e.rejectedAttemptCount}:e.rejectedAttemptCount>0?{id:-1,creationTime:s,relativeTime:n,problemIndex:a,dirty:e.rejectedAttemptCount}:null})).filter((e=>null!==e))})}a.participantNumber=i,U.value=!1},$=()=>{x(j.value)};return i((()=>v.params),(async e=>{if(e.id){R();const s=(t=+e.id,null!=(a=S.get(+t))?a:null);if(null!==s)j.value=s,await x(j.value),document.title=`${s.name} - CPany`;else{const t=await(async e=>{const t=new URL("https://codeforces.com/api/contest.list"),a="codeforces/contest.list",{result:s}=sessionStorage.getItem(a)?{result:JSON.parse(sessionStorage.getItem(a))}:await(await fetch(t.toString())).json();sessionStorage.getItem(a)||sessionStorage.setItem(a,JSON.stringify(s));for(const n of s)if(n.id===e)return{type:"codeforces",name:n.name,startTime:n.startTimeSeconds,duration:n.durationSeconds,participantNumber:0,id:n.id,phase:n.phase,contestUrl:`https://codeforces.com/contest/${n.id}`,standingsUrl:`https://codeforces.com/contest/${n.id}/standings`}})(+e.id);if(t)P.value=!0,j.value=t,await x(j.value),document.title=`${t.name} - CPany`;else{N.value=!0;const e=setTimeout((()=>T.replace({name:"Home"})),3e3);y((()=>clearTimeout(e)))}}O()}var t,a}),{immediate:!0}),(e,t)=>(c(),p("div",null,[j.value&&!N.value?(c(),p("div",C,[l(b,{contest:j.value,dynamic:P.value,onRefresh:$},null,8,["contest","dynamic"])])):N.value?(c(),p("div",I,[w,m("p",A,"未找到 ID 为 "+d(u(v).params.id)+" 的 Codeforces 比赛",1)])):f("v-if",!0)]))}});export{N as default};
