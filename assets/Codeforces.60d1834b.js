import{P as e,V as t}from"./index.226d3075.js";import{i as s,e as a,B as n,C as o,j as r,x as i,o as c,b as p,m as l,d as m,t as d,u,h as f,A as y}from"./vendor.5658d620.js";import{l as v}from"./load.8c215a92.js";import{c as T}from"./codeforces.9e4da7d5.js";import{_ as b,h,f as g}from"./Contest.b4c341d2.js";import"./c-table.a14218c8.js";import"./user-link.69187dfa.js";import"./cf-rating-color.6f65a69d.js";import"./nc-rating-color.176ea023.js";const j=v(T),S=new Map;for(const P of j)P.type.startsWith("codeforces")&&S.set(P.id,P);const C={key:0},I={key:1,class:"divide-y"},w=m("h2",{class:"mb-2"},"错误",-1),A={class:"pt-2"},N=a({setup(a){const v=n(),T=o(),j=r(null),N=r(!1),P=r(!1),{start:R,end:O}=function(){const e=s("loading");return{start(){e.value=!0},end(){e.value=!1}}}(),U=r(!1),x=async s=>{var a,n;if(U.value)return;U.value=!0;const o=new URL("https://codeforces.com/api/contest.standings");o.searchParams.append("contestId",""+s.id),o.searchParams.append("handles",h.map((({h:e})=>e)).join(";")),o.searchParams.append("showUnofficial","true");const{result:r}=await(await fetch(o.toString())).json();let i=0;s.problems=r.problems;for(const e of r.problems)e.problemUrl=`https://codeforces.com/contest/${e.contestId}/problem/${e.index}`;s.standings=[];for(const c of r.rows){if(c.party.participantType!==e.CONTESTANT&&c.party.participantType!==e.VIRTUAL&&c.party.participantType!==e.OUT_OF_COMPETITION&&c.party.participantType!==e.PRACTICE)continue;c.party.participantType!==e.PRACTICE&&i++;const o=c.problemResults.reduce(((e,t)=>{var s,a;return 0===t.points?e:e+(null!=(s=t.bestSubmissionTimeSeconds)?s:0)+20*(null!=(a=t.rejectedAttemptCount)?a:0)}),0),r=null!=(a=c.party.participantTime)?a:s.startTime;s.standings.push({author:{members:c.party.members.map((e=>e.handle)),teamName:null!=(n=c.party.teamName)?n:g(c.party.members[0].handle),participantTime:r,participantType:c.party.participantType},rank:c.rank,solved:c.problemResults.filter((e=>e.points>0)).length,penalty:o,submissions:c.problemResults.map(((e,s)=>{const a=e.bestSubmissionTimeSeconds+r,n=e.bestSubmissionTimeSeconds;return e.points>0?{id:-1,creationTime:a,relativeTime:n,problemIndex:s,verdict:t.OK,dirty:e.rejectedAttemptCount}:e.rejectedAttemptCount>0?{id:-1,creationTime:a,relativeTime:n,problemIndex:s,dirty:e.rejectedAttemptCount}:null})).filter((e=>null!==e))})}s.participantNumber=i,U.value=!1},$=()=>{x(j.value)};return i((()=>v.params),(async e=>{if(e.id){R();const a=(t=+e.id,null!=(s=S.get(+t))?s:null);if(null!==a)j.value=a,await x(j.value),document.title=`${a.name} - CPany`;else{const t=await(async e=>{const t=new URL("https://codeforces.com/api/contest.list"),s="codeforces/contest.list",{result:a}=sessionStorage.getItem(s)?{result:JSON.parse(sessionStorage.getItem(s))}:await(await fetch(t.toString())).json();sessionStorage.getItem(s)||sessionStorage.setItem(s,JSON.stringify(a));for(const n of a)if(n.id===e)return{type:"codeforces",name:n.name,startTime:n.startTimeSeconds,duration:n.durationSeconds,participantNumber:0,id:n.id,phase:n.phase,contestUrl:`https://codeforces.com/contest/${n.id}`,standingsUrl:`https://codeforces.com/contest/${n.id}/standings`}})(+e.id);if(t)P.value=!0,j.value=t,await x(j.value),document.title=`${t.name} - CPany`;else{N.value=!0;const e=setTimeout((()=>T.replace({name:"Home"})),3e3);y((()=>clearTimeout(e)))}}O()}var t,s}),{immediate:!0}),(e,t)=>(c(),p("div",null,[j.value&&!N.value?(c(),p("div",C,[l(b,{contest:j.value,dynamic:P.value,onRefresh:$},null,8,["contest","dynamic"])])):N.value?(c(),p("div",I,[w,m("p",A,"未找到 ID 为 "+d(u(v).params.id)+" 的 Codeforces 比赛",1)])):f("v-if",!0)]))}});export{N as default};
